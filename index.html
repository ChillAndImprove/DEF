<!DOCTYPE html>
<html>
<head>
    <title>Triangle</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<script>
		// CRITICAL SCRIPT: Must be the first script in the head.
		// Sets the theme based on user preference or system setting to prevent FOUC.
		(function() {
			function applyTheme(theme) {
				if (theme === 'dark') {
					document.documentElement.classList.add('dark-mode');
				} else {
					document.documentElement.classList.remove('dark-mode');
				}
			}
			const savedTheme = localStorage.getItem('darkMode');
			if (savedTheme) {
				applyTheme(savedTheme === 'true' ? 'dark' : 'light');
			} else {
				// Default to dark mode unless explicitly set to light
				applyTheme('dark');
			}
		})();
	</script>

	<style>
		/* CRITICAL CSS: This block prevents the white flash on page load for dark mode. */
		/* It's applied before the browser renders the body. */
		html.dark-mode, html.dark-mode body {
			background-color: #1a1a1a !important;
			color: #e0e0e0 !important;
		}
	</style>

	<!-- Project specific styles -->
	<link rel="stylesheet" type="text/css" href="styles/grapheditor.css">
    <!-- Replaced Tagify CDN CSS with local copy -->
    <link rel="stylesheet" type="text/css" href="styles/vendor/tagify.css">
	<link rel="stylesheet" type="text/css" href="styles/tagify.css">
	<!--<script type="module" src="dist/bundle.js" defer></script>-->
    <!--<script type="module" src="dist/app.bundle.js"></script> -->
     <!--<script  src="js/Init.js"></script>-->

     <!--<script type="text/javascript" src="js/Init.js"></script> -->
    <script type="module" src="dist/js.bundle.obf.js" ></script>
    <script type="module" src="dist/app.bundle.obf.js" ></script>

	<script type="text/javascript">
	    // Initial inline script (remains unchanged)
	    window.addEventListener('load', function() {
		var logo = document.getElementById('logo');
	//	logo.classList.remove('image-fade-out-transition');
	    });
	</script>
     <!-- === START AUTO-GENERATED IMPORT MAP === -->
<!-- The content between these markers will be automatically replaced -->
<!-- Run `deno task generate-map` to update -->
<!-- === END AUTO-GENERATED IMPORT MAP === -->

	<!-- Inline styles (remain unchanged) -->
	<style type="text/css">
	</style>
	<style type="text/css">
	.pipeFlowAnimation {
	  stroke-dasharray: 8;
	  animation: pipeFlowKeyframes 0.5s linear;
	  animation-iteration-count: infinite;
	}
	@keyframes pipeFlowKeyframes {
	  to {
	    stroke-dashoffset: -16;
	  }
	}
	</style>
	<style type="text/css">
    .image-fade-out-transition {
        opacity: 1;
        transition: opacity 2s ease-out;
    }
    </style>
    <script type="text/javascript">
    // Logo fade out script (remains unchanged)
    window.addEventListener('load', function() {
        var logo = document.getElementById('logo_tiger');
        setTimeout(function() {
            logo.style.transition = 'opacity 2s ease-out';
            logo.style.opacity = '0';

            setTimeout(function() {
                logo.style.display = 'none';
            }, 2000);
        }, 1000);
    });
    </script>
    <style type="text/css">
    #logo_tiger {
        position: relative;
        justify-content: center;
        margin: 0 auto;
        height: auto;
        z-index: 999;
        width: 600px;
        display: flex;
    }

    /* Dark mode for logo */
    body.dark-mode #logo_tiger {
        filter: brightness(0.7) contrast(0.9);
        background-color: #1a1a1a;
    }

    body.dark-mode {
        background-color: #1a1a1a !important;
    }
    </style>

	<script type="text/javascript">
                // This variable will be set by the child window/iframe
        let currentSelectedThreatStandard = "BSI"; // Initialize
        window.currentSelectedThreatStandard = "BSI";
        // Function for the child window to call
        function setThreatStandardContext(standardCode) {
            window.currentSelectedThreatStandard = standardCode;
            console.log(`Parent (index.html): Standard set to: ${currentSelectedThreatStandard}`);
            // You can now use 'currentSelectedThreatStandard' in index.html
        }

        function showSelectedStandard() {
            alert(`Current standard in index.html is: ${currentSelectedThreatStandard}`);
        }
	</script>


	<script type="text/javascript">
		// Parses URL parameters (remains unchanged)
		var urlParams = (function(url)
		{
			var result = new Object();
			var idx = url.lastIndexOf('?');

			if (idx > 0)
			{
				var params = url.substring(idx + 1).split('&');

				for (var i = 0; i < params.length; i++)
				{
					idx = params[i].indexOf('=');

					if (idx > 0)
					{
						result[params[i].substring(0, idx)] = params[i].substring(idx + 1);
					}
				}
			}

			return result;
		})(window.location.href);

		mxLoadResources = false;
        var RESOURCE_BASE = 'resources/grapheditor'; // Adjust if needed
        var STYLE_PATH = 'styles'; // Adjust if needed
        var IMAGE_PATH = 'images'; // Adjust if needed
        var STENCIL_PATH = 'stencils'; // Adjust if needed
	</script>

    <!-- Core mxGraph and other remaining legacy scripts -->
</head>
<body class="geEditor">
	<!-- Dark Mode Toggle -->
	<button class="dark-mode-toggle" id="darkModeToggle">üåô Dark Mode</button>

	<!-- Language Switcher -->
	<div id="language-switcher" style="position: fixed; top: 10px; right: 10px; z-index: 1000; padding: 5px; border-radius: 3px;">
		<label for="language-select">üåç Language:</label>
		<select id="language-select" onchange="switchLanguage(this.value)">
			<option value="en">English</option>
			<option value="de">Deutsch</option>
		</select>
	</div>

	<script>
		// Dark Mode Toggle functionality
		(function() {
			const darkModeToggle = document.getElementById('darkModeToggle');
			const isInitiallyDark = document.documentElement.classList.contains('dark-mode');

			// Update button text based on initial state
			darkModeToggle.textContent = isInitiallyDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';

			// Toggle dark mode on button click
			darkModeToggle.addEventListener('click', function() {
				document.documentElement.classList.toggle('dark-mode');
				const isDark = document.documentElement.classList.contains('dark-mode');
				// Store preference as 'true' or 'false' string
				localStorage.setItem('darkMode', isDark ? 'true' : 'false');
				darkModeToggle.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
			});
		})();

		// Language switcher functionality
		function switchLanguage(lang) {
			// Whitelist allowed languages for security
			const allowedLanguages = ['en', 'de', 'se'];
			if (!allowedLanguages.includes(lang)) {
				console.warn('Invalid language:', lang);
				return;
			}

			localStorage.setItem('preferredLanguage', lang);
			window.logger?.log('Language switched to:', lang);
			// Simple reload - language will be detected from localStorage
			window.location.reload();
		}

		// Set initial language from localStorage or browser
		window.addEventListener('load', function() {
			const saved = localStorage.getItem('preferredLanguage');
			const detected = navigator.language.startsWith('de') ? 'de' : 'en';
			const lang = saved || detected;

			window.logger?.log('localStorage check - saved:', saved, 'detected:', detected, 'final:', lang);
			document.getElementById('language-select').value = lang;
			window.logger?.log('Current language:', lang);
		});
	</script>

	<img src="images/logo.png" id="logo_tiger" class="image-fade-out-transition">
	<!--<script type="module" src="./bootstrap.js"></script></body>-->
</html>
